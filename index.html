<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - WarehouseWrangler</title>
    <link rel="stylesheet" href="./css/main.css">
    <link rel="icon" type="image/png" href="/favicon.ico"/>
    <script>
        // Inline auth check to avoid loading issues
        (function() {
            // Get token from localStorage
            const token = localStorage.getItem('ww_auth_token');
            
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            // Basic token validation
            try {
                const parts = token.split('.');
                if (parts.length !== 3) {
                    localStorage.removeItem('ww_auth_token');
                    window.location.href = 'login.html';
                    return;
                }
                
                const payload = JSON.parse(atob(parts[1]));
                const now = Math.floor(Date.now() / 1000);
                
                if (payload.exp <= now) {
                    // Token expired
                    localStorage.removeItem('ww_auth_token');
                    window.location.href = 'login.html';
                    return;
                }
            } catch (e) {
                console.error('Token validation error:', e);
                localStorage.removeItem('ww_auth_token');
                window.location.href = 'login.html';
                return;
            }
        })();
    </script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <h1>üè≠ WarehouseWrangler</h1>
            <p>Loading...</p>
        </div>
    </div>

    <!-- Main Dashboard (hidden until auth check complete) -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <h1>üè≠ WarehouseWrangler</h1>
            </div>
            <div class="header-right">
                <a href="users.html" class="btn-secondary" style="margin-right: 12px;">üë• Benutzer</a>
                <a href="lc-upload.html" class="btn-secondary" style="margin-right: 12px;">üÜï LC-File laden</a>
                <span id="userDisplay">Loading...</span>
                <button id="logoutBtn" class="btn-logout">Logout</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <h2>Welcome to WarehouseWrangler!</h2>
            <p>Dashboard coming soon...</p>
            <div style="margin-top: 20px; padding: 20px; background: white; border-radius: 8px;">
                <h3>üéâ Login System Working!</h3>
                <p>You've successfully logged in to WarehouseWrangler.</p>
                <p><strong>Quick Actions:</strong></p>
                <ul>
                    <li><a href="users.html" style="color: #667eea; text-decoration: none; font-weight: 500;">üë• Manage Users</a> - Add, edit, and manage user accounts</li>
                    <li><a href="products.html" style="color: #667eea; text-decoration: none; font-weight: 500;">üì¶ Manage Products</a> - Add, edit, and manage your products</li>
                    <li>üìã Carton Management (Coming soon)</li>
                    <li>üìä Amazon Integration (Coming soon)</li>
                </ul>
            </div>
        </main>
    </div>

    <!-- Main App Script -->
    <script>
        // Show the application after auth check passes
        document.addEventListener('DOMContentLoaded', function() {
            const loadingScreen = document.getElementById('loadingScreen');
            const mainApp = document.getElementById('mainApp');
            const userDisplay = document.getElementById('userDisplay');
            
            // Get user data from localStorage
            const userDataStr = localStorage.getItem('ww_user_data');
            if (userDataStr) {
                try {
                    const userData = JSON.parse(userDataStr);
                    if (userData && userDisplay) {
                        userDisplay.textContent = `üë§ ${userData.username}`;
                    }
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }

            // Hide loading, show app
            if (loadingScreen) {
                loadingScreen.style.display = 'none';
            }
            if (mainApp) {
                mainApp.classList.remove('hidden');
            }

            // Setup logout button
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to logout?')) {
                        // Clear auth data
                        localStorage.removeItem('ww_auth_token');
                        localStorage.removeItem('ww_user_data');
                        // Redirect to login
                        window.location.href = 'login.html';
                    }
                });
            }
        });
    </script>
</body>
</html>
